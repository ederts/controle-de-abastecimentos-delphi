/******************************************************************************/
/****        Generated by IBExpert 2015.12.21.1 27/09/2022 00:16:20        ****/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES WIN1252;

SET CLIENTLIB 'fbclient.dll';

CREATE DATABASE 'C:\Sistema\fortes\posto\dados\POSTO.fdb'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 8192
DEFAULT CHARACTER SET WIN1252 COLLATION WIN_PTBR;



/******************************************************************************/
/****                              Generators                              ****/
/******************************************************************************/

CREATE GENERATOR GEN_ABASTECIMENTOS_ID;
SET GENERATOR GEN_ABASTECIMENTOS_ID TO 8;

CREATE GENERATOR GEN_BOMBAS_ID;
SET GENERATOR GEN_BOMBAS_ID TO 16;

CREATE GENERATOR GEN_COMBUSTIVEIS_ID;
SET GENERATOR GEN_COMBUSTIVEIS_ID TO 4;

CREATE GENERATOR GEN_TANQUES_ID;
SET GENERATOR GEN_TANQUES_ID TO 17;

CREATE GENERATOR GEN_USUARIOS_ID;
SET GENERATOR GEN_USUARIOS_ID TO 5;



/******************************************************************************/
/****                                Tables                                ****/
/******************************************************************************/



CREATE TABLE ABASTECIMENTOS (
    ID                    INTEGER NOT NULL,
    BOMBA                 INTEGER,
    TANQUE                INTEGER,
    COMBUSTIVEL           INTEGER,
    VALORUNITARIO         NUMERIC(15,2),
    QUANTIDADE            NUMERIC(15,3),
    VALORTOTALBRUTO       NUMERIC(15,2),
    VALORIMPOSTO          NUMERIC(15,2),
    VALORTOTALCOMIMPOSTO  NUMERIC(15,2),
    DATAMOVIMENTO         DATE
);

CREATE TABLE BOMBAS (
    ID         INTEGER NOT NULL,
    DESCRICAO  VARCHAR(50),
    TANQUE     INTEGER,
    INATIVO    VARCHAR(1)
);

CREATE TABLE COMBUSTIVEIS (
    ID          INTEGER NOT NULL,
    DESCRICAO   VARCHAR(50),
    PRECOLITRO  NUMERIC(15,2),
    INATIVO     VARCHAR(1)
);

CREATE TABLE TANQUES (
    ID           INTEGER NOT NULL,
    DESCRICAO    VARCHAR(50),
    COMBUSTIVEL  INTEGER,
    INATIVO      VARCHAR(1)
);

CREATE TABLE USUARIOS (
    ID       INTEGER NOT NULL,
    NOME     VARCHAR(60),
    SENHA    VARCHAR(50),
    INATIVO  VARCHAR(1)
);

INSERT INTO COMBUSTIVEIS (ID, DESCRICAO, PRECOLITRO, INATIVO) VALUES (1, 'GASOLINA', 5.4, 'F');
INSERT INTO COMBUSTIVEIS (ID, DESCRICAO, PRECOLITRO, INATIVO) VALUES (2, 'OLEO DIESEL', 4.25, 'F');

COMMIT WORK;

INSERT INTO TANQUES (ID, DESCRICAO, COMBUSTIVEL, INATIVO) VALUES (13, 'TANQUE 1', 1, 'F');
INSERT INTO TANQUES (ID, DESCRICAO, COMBUSTIVEL, INATIVO) VALUES (14, 'TANQUE 2', 2, 'F');

COMMIT WORK;

INSERT INTO BOMBAS (ID, DESCRICAO, TANQUE, INATIVO) VALUES (1, 'BOMBA 1', 13, 'F');
INSERT INTO BOMBAS (ID, DESCRICAO, TANQUE, INATIVO) VALUES (2, 'BOMBA 2', 13, 'F');
INSERT INTO BOMBAS (ID, DESCRICAO, TANQUE, INATIVO) VALUES (3, 'BOMBA 3', 14, 'F');
INSERT INTO BOMBAS (ID, DESCRICAO, TANQUE, INATIVO) VALUES (15, 'BOMBA 4', 14, 'F');

COMMIT WORK;

INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (1, 1, 13, 1, 5.4, 5.543, 29.93, 3.89, 33.82, '2022-09-26');
INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (2, 1, 13, 1, 5.4, 3.45, 18.63, 2.42, 21.05, '2022-09-26');
INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (3, 3, 14, 2, 4.25, 4.6, 19.55, 2.54, 22.09, '2022-09-26');
INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (4, 15, 14, 2, 4.25, 4.58, 19.46, 2.53, 22, '2022-09-26');
INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (5, 1, 13, 1, 5.4, 10.004, 54.02, 7.02, 61.04, '2022-09-26');
INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (6, 2, 13, 1, 5.4, 2, 10.8, 1.4, 12.2, '2022-09-26');
INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (7, 3, 14, 2, 4.25, 3.456, 14.69, 1.91, 16.6, '2022-09-26');
INSERT INTO ABASTECIMENTOS (ID, BOMBA, TANQUE, COMBUSTIVEL, VALORUNITARIO, QUANTIDADE, VALORTOTALBRUTO, VALORIMPOSTO, VALORTOTALCOMIMPOSTO, DATAMOVIMENTO) VALUES (8, 1, 13, 1, 5.4, 45, 243, 31.59, 274.59, '2022-09-27');

COMMIT WORK;

INSERT INTO USUARIOS (ID, NOME, SENHA, INATIVO) VALUES (5, 'EDER', '123', 'F');

COMMIT WORK;



/******************************************************************************/
/****                             Primary keys                             ****/
/******************************************************************************/

ALTER TABLE ABASTECIMENTOS ADD CONSTRAINT PK_ABASTECIMENTOS PRIMARY KEY (ID);
ALTER TABLE BOMBAS ADD CONSTRAINT PK_BOMBAS PRIMARY KEY (ID);
ALTER TABLE COMBUSTIVEIS ADD CONSTRAINT PK_COMBUSTIVEIS PRIMARY KEY (ID);
ALTER TABLE TANQUES ADD CONSTRAINT PK_TANQUES PRIMARY KEY (ID);
ALTER TABLE USUARIOS ADD CONSTRAINT PK_USUARIOS PRIMARY KEY (ID);


/******************************************************************************/
/****                             Foreign keys                             ****/
/******************************************************************************/

ALTER TABLE ABASTECIMENTOS ADD CONSTRAINT FK_ABAST_BOMBA FOREIGN KEY (BOMBA) REFERENCES BOMBAS (ID);
ALTER TABLE ABASTECIMENTOS ADD CONSTRAINT FK_ABAST_COMBUSTIVEL FOREIGN KEY (COMBUSTIVEL) REFERENCES COMBUSTIVEIS (ID);
ALTER TABLE ABASTECIMENTOS ADD CONSTRAINT FK_ABAST_TANQUE FOREIGN KEY (TANQUE) REFERENCES TANQUES (ID);
ALTER TABLE BOMBAS ADD CONSTRAINT FK_BOMBAS_TANQUE FOREIGN KEY (TANQUE) REFERENCES TANQUES (ID);
ALTER TABLE TANQUES ADD CONSTRAINT FK_TANQUES_COMB FOREIGN KEY (COMBUSTIVEL) REFERENCES COMBUSTIVEIS (ID);


/******************************************************************************/
/****                               Triggers                               ****/
/******************************************************************************/



SET TERM ^ ;



/******************************************************************************/
/****                         Triggers for tables                          ****/
/******************************************************************************/



/* Trigger: ABASTECIMENTOS_BI */
CREATE TRIGGER ABASTECIMENTOS_BI FOR ABASTECIMENTOS
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_abastecimentos_id,1);
end
^

/* Trigger: BOMBAS_BI */
CREATE TRIGGER BOMBAS_BI FOR BOMBAS
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_bombas_id,1);
end
^

/* Trigger: COMBUSTIVEIS_BI */
CREATE TRIGGER COMBUSTIVEIS_BI FOR COMBUSTIVEIS
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_combustiveis_id,1);
end
^

/* Trigger: TANQUES_BI */
CREATE TRIGGER TANQUES_BI FOR TANQUES
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_tanques_id,1);
end
^

/* Trigger: USUARIOS_BI */
CREATE TRIGGER USUARIOS_BI FOR USUARIOS
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_usuarios_id,1);
end
^
SET TERM ; ^

